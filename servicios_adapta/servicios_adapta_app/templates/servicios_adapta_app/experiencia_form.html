{% extends './base.html' %}
{% block title %}Experiencia-Agregar{% endblock %}
{% block content %}
<div class="container">
    <div class="left">
        <div class="div-atras">
            <a class="boton-atras" href="{% url 'experiencia-tabla' %}"> <- Atrás</a>
        </div>
        <h1>Experiencias</h1>
        <div class="info">
            <label class="title">Instrucciones</label>
            <p></p>
        </div>
    </div>
    <div class="right">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <label for="codigo" class="title">Código</label>
            <br>
            <input type="text" name="codigo" required>
            <br>
            <br>
            <label for="dia-inicio" class="title">Fecha de Inicio (dd/mm/yyyy)</label>
            <br>
            <input type="text" name="dia-inicio" maxlength="2" placeholder="dd" required> / 
            <input type="text" name="mes-inicio" maxlength="2" placeholder="mm" required> / 
            <input type="text" name="ano-inicio" maxlength="4" placeholder="aaaa" required>
            <br>
            <br>
            <label for="dia-inicio" class="title">Fecha Fin (dd/mm/yyyy)</label>
            <br>
            <input type="text" name="dia-fin" maxlength="2"  value="00"> / 
            <input type="text" name="mes-fin" maxlength="2"  value="00"> / 
            <input type="text" name="ano-fin" maxlength="4"  value="0000">
            <br>
            <br>
            <label for="cat-servicios" class="title">Categoría de Servicios</label>
            <br>
            <select name="cat-servicios" required>
                {% for choice in CAT_CHOICES %}
                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
            <br>
            <br>
            <label for="ficha" class="title">Ficha</label>
            <br>
            <input type="url" id="ficha_url" name="ficha" placeholder="Ingrese una URL válida">
            <br>
            <br>
            <label for="atestado" class="title">Atestado</label>
            <br>
            <input type="url" id="atestado_url" name="atestado" placeholder="Ingrese una URL válida">
            <br>
            <br>
            <label for="proyecto" class="title">Proyecto</label>
            <br>
            <select name="proyecto" required>
                {% for proyecto in proyectos %}
                <option value="{{ proyecto.id }}">{{ proyecto.nombre }}</option>
                {% endfor %}
            </select>
            <br>
            <br>
            <h3>Empleados y Roles</h3>
            <table id="empleados-table">
                <tr>
                    <th>Empleado</th>
                    <th>Rol</th>
                </tr>
                <tr class="empleado-row">
                    <td>
                        <select name="empleado" class="empleado-select" required>
                            <option value="" selected disabled>Seleccionar empleado</option>
                            {% for empleado in empleados %}
                                <option value="{{ empleado.id }}">{{ empleado.nombre }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="rol" class="rol-select" required>
                            <option value="" selected disabled>Seleccionar rol</option>
                            {% for rol in roles %}
                                <option value="{{ rol.id }}">{{ rol.nombre }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
            </table>

            <button type="button" id="add-empleado">Agregar Empleado</button>
            <br>
            <br>
            <button type="submit">Guardar Contrato</button>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        let empleadoRowTemplate = `
            <tr class="empleado-row">
                <td>
                    <select name="empleado" class="empleado-select" required>
                        <option value="" selected disabled>Seleccionar empleado</option>
                        {% for empleado in empleados %}
                            <option value="{{ empleado.id }}">{{ empleado.nombre }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <select name="rol" class="rol-select" required>
                        <option value="" selected disabled>Seleccionar rol</option>
                        {% for rol in roles %}
                            <option value="{{ rol.id }}">{{ rol.nombre }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td>
                    <button type="button" class="remove-empleado">Eliminar</button>
                </td>
            </tr>
        `;

        $("#add-empleado").click(function () {
            $("#empleados-table").append(empleadoRowTemplate);
        });

        $(document).on("click", ".remove-empleado", function () {
            $(this).closest(".empleado-row").remove();
        });
    });
</script>
{% endblock %}